# standart imports
import asyncio
import logging
from aiogram import Bot, Dispatcher

# my imports
from bot.handlers import start_router, video_router
from core.config import BOT_TOKEN
from core.logging import ensure_log_directories
from db import init_db, init_mongo

__ROUTERS = [
    start_router,
    video_router,
]


async def main():
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (—Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤)
    ensure_log_directories()
    logging.basicConfig(level=logging.INFO)

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    await init_db()
    logging.getLogger("startup").info("üêò –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")
    await init_mongo()
    logging.getLogger("startup").info("üóÇÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö MONGO –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    bot = Bot(token=BOT_TOKEN)
    dp = Dispatcher()

    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤
    dp.include_routers(*__ROUTERS)

    # –ó–∞–ø—É—Å–∫
    logging.getLogger("startup").info("üöÄ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!")
    await dp.start_polling(bot)


if __name__ == "__main__":
    asyncio.run(main())
